# DairyComp CLI - Руководство по RC кодам

## Что такое RC (Reproductive Code)?

RC код - это числовой статус воспроизводства животного в DairyComp 305. Это ключевой показатель для управления циклом воспроизводства стада.

## Все RC коды и их значение

| RC | Название | Описание | Когда присваивается |
|----|----------|----------|---------------------|
| 0 | BLANK | Нет статуса | Телки до первого осеменения, новорожденные телята |
| 1 | DNB | Do Not Breed (Не осеменять) | Животные, выбранные для выбраковки или имеющие проблемы |
| 2 | FRESH | Свежая корова | После отела до первого осеменения (обычно 0-60 DIM) |
| 3 | OPEN | Открытая (готова к осеменению) | После добровольного периода ожидания (>60 DIM), не стельная |
| 4 | BRED | Осеменена | После осеменения до подтверждения стельности |
| 5 | PREG | Стельная (беременная) | После положительного теста на стельность |
| 6 | DRY | Запущенная (сухостойная) | За 60 дней до предполагаемого отела |
| 7 | SOLD/DIED | Продана/Пала | Выбыла из стада |
| 8 | BULLCALF | Бычок | Теленок мужского пола |

## Типичный цикл воспроизводства

```
ОТЕЛ → RC=2 (FRESH) → RC=3 (OPEN) → RC=4 (BRED) → RC=5 (PREG) → RC=6 (DRY) → ОТЕЛ...
  ↓                                                                              ↑
День 0                                                                    ~280 дней
```

### Временные рамки:
- **DIM 0-21**: RC=2 (FRESH) - период восстановления
- **DIM 21-60**: Переход RC=2→3, добровольный период ожидания
- **DIM 60+**: RC=3 (OPEN) - готова к осеменению
- **После AI**: RC=4 (BRED) - ждем проверки стельности
- **35-45 дней после AI**: Проверка стельности
  - Если PREG → RC=5
  - Если OPEN → возврат к RC=3
- **DCC < 60** (Days to Calving): RC=6 (DRY) - запуск

## Примеры команд CLI

### 1. Показать всех животных по RC коду

```bash
# Все свежие коровы (недавно отелились)
LIST ID PEN LACT DIM FOR RC=2

# Коровы готовые к осеменению
LIST ID PEN LACT DIM FOR RC=3

# Осемененные коровы (ждут проверки)
LIST ID PEN LACT DIM FOR RC=4

# Стельные коровы
LIST ID PEN LACT DIM FOR RC=5

# Запущенные коровы
LIST ID PEN LACT DIM FOR RC=6
```

### 2. Комбинированные фильтры

```bash
# Свежие коровы старше 21 дня (готовы к переводу в OPEN)
LIST ID PEN DIM FOR RC=2 DIM>21

# Осемененные коровы, которым пора на проверку стельности
LIST ID PEN LACT FOR RC=4 DIM>95

# Стельные коровы близкие к запуску (осталось <80 дней)
LIST ID PEN LACT FOR RC=5 DCC<80

# Открытые коровы с высокой лактацией (приоритет для осеменения)
LIST ID PEN LACT DIM FOR RC=3 LACT>2 DIM>60
```

### 3. Специальные списки

```bash
# "To Breed" список - коровы готовые к осеменению сегодня
LIST ID PEN LACT DIM FOR RC=3 DIM>60

# "Preg Check" список - коровы для проверки стельности
LIST ID PEN LACT DIM FOR RC=4 DIM>95

# "Dry Off" список - коровы для запуска
LIST ID PEN LACT FOR RC=5 DCC<60

# Проблемные коровы - DNB или >150 дней открыты
LIST ID PEN LACT DIM FOR RC=1
LIST ID PEN LACT DIM FOR RC=3 DIM>150
```

### 4. Подсчет животных по RC

```bash
# Количество по каждому RC коду
LIST ID FOR RC=0  # Посчитать телок/телят
LIST ID FOR RC=2  # Свежие коровы
LIST ID FOR RC=3  # Открытые
LIST ID FOR RC=4  # Осемененные
LIST ID FOR RC=5  # Стельные
LIST ID FOR RC=6  # Запущенные
```

### 5. Отчеты и анализ

```bash
# Все коровы НЕ стельные (нужно внимание)
LIST ID PEN LACT DIM FOR RC<>5 RC<>6 DIM>60

# Все животные в активном воспроизводстве
LIST ID PEN LACT DIM FOR RC>=2 RC<=5

# Молодняк без статуса
LIST ID PEN FOR RC=0

# Коровы на выбраковку
LIST ID PEN LACT FOR RC=1
LIST ID PEN LACT FOR RC=7
```

## Правила изменения RC кода

### Автоматические изменения (система должна делать):
1. **После отела**: RC → 2 (FRESH)
2. **DIM > 60 + не осеменена**: RC 2 → 3 (OPEN)
3. **После осеменения**: RC → 4 (BRED)
4. **Положительный preg check**: RC → 5 (PREG)
5. **Отрицательный preg check**: RC → 3 (OPEN)
6. **DCC < 60**: RC → 6 (DRY)

### Ручные изменения (пользователь):
1. **Проблемы со здоровьем**: RC → 1 (DNB)
2. **Выбраковка**: RC → 7 (SOLD/DIED)
3. **Корректировка ошибок**

## KPI на основе RC кодов

### Pregnancy Rate (PR)
```
PR = (Количество RC=5) / (Количество RC=3,4,5) × 100
```
Целевое значение: >25%

### Conception Rate (CR)
```
CR = (Стельных после 1-го AI) / (Всего осемененных) × 100
```
Целевое значение: >40%

### Days Open (среднее)
Среднее количество дней от отела до зачатия для RC=5
Целевое значение: <100 дней

## Частые ошибки

❌ **Неправильно**: Держать корову в RC=2 (FRESH) больше 60 дней
✅ **Правильно**: Перевести в RC=3 (OPEN) после 60 DIM

❌ **Неправильно**: Осеменить корову без перевода в RC=3
✅ **Правильно**: RC=3 → осеменение → RC=4

❌ **Неправильно**: Не проверять стельность RC=4 коров вовремя
✅ **Правильно**: Preg check через 35-45 дней после AI

## Интеграция с GUI

При выполнении команды в CLI, соответствующий раздел в боковой панели подсвечивается:

| CLI команда | Подсветка в Sidebar |
|-------------|---------------------|
| `RC=2` | Fresh Cows |
| `RC=3 DIM>60` | To Breed |
| `RC=4` | Pregnancy Check |
| `RC=5 DCC<60` | Dry Off |

## Технические детали

### Хранение в БД
- **Поле**: `animals.reproductive_status` (VARCHAR)
- **Значения**: 'blank', 'dnb', 'fresh', 'open', 'bred', 'preg', 'dry', 'sold', 'bullcalf'

### Конвертация RC ↔ reproductive_status
Выполняется автоматически:
- **При запросе**: `RC=5` → `WHERE reproductive_status='preg'`
- **При выводе**: `reproductive_status='preg'` → отображается как `RC: 5`

Модуль: `apps/web/src/lib/cli/rc-code-mapping.ts`

## Примеры реальных сценариев

### Утренняя проверка (Morning Check)
```bash
# 1. Кого осеменять сегодня?
LIST ID PEN LACT DIM FOR RC=3 DIM>60

# 2. Кого проверить на стельность?
LIST ID PEN LACT DIM FOR RC=4 DIM>95

# 3. Свежие коровы - как себя чувствуют?
LIST ID PEN DIM MILK FOR RC=2 DIM<21
```

### Еженедельный отчет
```bash
# Распределение по RC кодам
LIST ID FOR RC=2  # Свежие
LIST ID FOR RC=3  # Открытые
LIST ID FOR RC=4  # Осемененные
LIST ID FOR RC=5  # Стельные
LIST ID FOR RC=6  # Запущенные

# Проблемные животные
LIST ID PEN LACT DIM FOR RC=3 DIM>150  # Долго открыты
LIST ID PEN LACT FOR RC=1              # DNB - почему?
```

### Подготовка к запуску
```bash
# Кого запускать в ближайшие 2 недели?
LIST ID PEN LACT FOR RC=5 DCC<75 DCC>60

# Уже в запуске
LIST ID PEN FOR RC=6
```

## Справочная таблица RC кодов

| Если корова... | То RC должен быть | Действие |
|---------------|-------------------|----------|
| Только что отелилась | 2 (FRESH) | Наблюдение 21 день |
| Отелилась >60 дней назад, не осеменена | 3 (OPEN) | Искать охоту, осеменить |
| Осеменена 1-34 дня назад | 4 (BRED) | Ждать проверки |
| Стельная, >60 дней до отела | 5 (PREG) | Контроль развития |
| Стельная, <60 дней до отела | 6 (DRY) | Сухостойный рацион |
| Имеет проблемы, не осеменяем | 1 (DNB) | Лечение или выбраковка |
| Продана/пала | 7 (SOLD/DIED) | Архив |

## Горячие клавиши в CLI

- `/` или `Ctrl+L` - фокус на CLI
- `↑` / `↓` - история команд
- `Enter` - выполнить команду
- `Esc` - очистить ввод / снять фокус

## Дополнительная информация

- **DIM**: Days in Milk - дней после отела
- **DCC**: Days to Calving - дней до отела
- **AI**: Artificial Insemination - искусственное осеменение
- **Preg Check**: Pregnancy Check - проверка стельности
